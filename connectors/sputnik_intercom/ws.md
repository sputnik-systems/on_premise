# Websocket connector

Websocket коннектор представляет собой real-time communication сервис (RTC), который поддерживает связь домофона и платформы Asgard.

При выходе домофона в сеть, устройство устанавливает вебсокет-соединение с RTC-сервисом. В процессе работы, домофон обменивается с сервисом сообщениями, которые могут содержать команды для домофона, пакеты со звуком, информацию об обновлении состоянии домофона.

## Задачи RTC:

- Обмен командами между домофоном и core-частью
- Совершение звонков
- Формирование логов устройства


### Внутренние зависимости:

- Core GraphQL API
- RabbitMQ

### Внешние зависимости:

- Yandex Speech Kit
- AWS S3

## Метрики

Метрики доступны по пути ```/metrics```

Общее:

|  Наименование         |    Описание               | Алерты |
|-----------------------|---------------------------|--------|
| rtc_intercom_status_info | Количество домофонов в онлайне |

SIP звонки:

|  Наименование         |    Описание               | Алерты |
|-----------------------|---------------------------|--------|
| rtc_started_sip_calls | Количество начатых звонков|
| rtc_speak_sip_calls   | Количество состоявшихся звонков |
| rtc_failed_sip_calls | Количество провалившихся звонков |
| rtc_sip_calls_duration | Средняя продолжительность звонков |

Аналоговые звонки:

|  Наименование         |    Описание               | Алерты |
|-----------------------|---------------------------|--------|
| rtc_started_analog_calls | Количество начатых звонков|
| rtc_speak_analog_calls   | Количество состоявшихся звонков |
| rtc_failed_analog_calls | Количество провалившихся звонков |
| rtc_analog_calls_duration | Средняя продолжительность звонков |

Кластерные звонки:

|  Наименование         |    Описание               | Алерты |
|-----------------------|---------------------------|--------|
| rtc_started_cluster_calls | Количество начатых звонков|
| rtc_speak_cluster_calls   | Количество состоявшихся звонков |
| rtc_failed_cluster_calls | Количество провалившихся звонков |
| rtc_cluster_call_duration | Средняя продолжительность звонков |

## Алерты:
### ManyIntercomReconnects
Информирует о большом количестве переподключений в течении 5 минут.
### NoNewStartedCalls
Информирует об отсутствии новых звонков в течении часа.
### FailedCalls
Информирует о большом количестве неудавшихся звонков за последние 5 минут.
### ManyActiveIntercoms
Информирует о большом количестве домофонов, зарегистрированных на одном поде RTC.
