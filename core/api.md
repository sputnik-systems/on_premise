# API

Сервиc API представляет собой своеобразные gateway приема клиентских запросов. Некоторая часть запроса обрабатывается в самом сервисе, дальше задачи идут в сервисы-коннекторы. 

Сервис имеет два внешних API:

1) Core GraphQL API
2) RestAPI (надстройка нал 1-ым)

### Применение 

Основной задачей сервиса API является обработка клиентких запросов.

Полный список запросов можно посомтреть [тут](https://developers.sputnik.systems/docs)

## Зависимости

###  Триггеры 

Данный микросервис отвечает за отлавливание событий и их обработку. Сейчас его основной задачей является обработка событий от панели: синхронизация информации при успешном применение настроек на панели / синхронизация статусов.

### Внутренние зависимости:

 - RabbitMQ  - хранение событий
 - ClickHouse - хранение логов
 - PostgreSQL - основная бд

### Внешние зависимости:

 - MinIO (AWS S3) - хранение фаилов (звуки / прошивки)

Так же API зависит от все коннекторов что подключены к нему.

## Метрики

 Метрики доступны по пути ```/metrics```

 |  Наименование         |    Описание               | Алерты |
 |-----------------------|---------------------------|--------|
 | gql_completed_requests_total | Количество запросов в Core GraphQL API |
 | http_request_duration_ms | Продолжительность запроса, мс |
 | trigger_active_total | Текущее кол-во активных триггеров |
 | trigger_processed_total | Количество событий, по которым обработан какой-либо триггер |
 | event_incoming_total | Количество всех входящих событий |


 ## HealthCheck

 Статус внутренних вервисов доступен по пути ```/health```

