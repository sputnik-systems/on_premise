# API

API - центр платформы, предоставляющий пользователю функциональность по управлению своими устройствами. Сервис не 
только хранит и обрабатывает информацию, но и принимает решения о совершении действий над устройствами.

Сервис взаимодействует с устройствами посредством коннекторов ([connectors](../connectors)), посылая им определенные 
события(event-driven подход). При этом API не зависит от коннекторов, что позволяет отключать и добавлять их по 
необходимости.

API предоставляет два внешних интерфейса:

1) GraphQL
2) Rest (список запросов можно посмотреть [тут](https://developers.sputnik.systems/docs))

## Подсистемы

###  Триггеры

Микросервис для обработки событий от коннекторов. Является ещё одним интерфейсом к бизнес-логике API, основанный на 
очереди сообщений, который отслеживает состояние устройств и процессов внутри платформы и актуализирует его в базе 
данных.

## Зависимости

### Внутренние зависимости:

 - RabbitMQ  - хранение событий
 - ClickHouse - хранение логов
 - PostgreSQL - основная бд

### Внешние зависимости:

 - MinIO (AWS S3) - хранение файлов (звуки / прошивки)

## Метрики

 Метрики доступны по пути ```/metrics```

 |  Наименование         |    Описание               | Алерты |
 |-----------------------|---------------------------|--------|
 | gql_completed_requests_total | Количество запросов в Core GraphQL API |
 | http_request_duration_ms | Продолжительность запроса, мс |
 | trigger_active_total | Текущее кол-во активных триггеров |
 | trigger_processed_total | Количество событий, по которым обработан какой-либо триггер |
 | event_incoming_total | Количество всех входящих событий |


 ## HealthCheck

 Статус внутренних вервисов доступен по пути ```/health```

